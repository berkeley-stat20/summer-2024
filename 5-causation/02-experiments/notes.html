<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Stat 20 - Randomized Experiments</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-WP7F4QKDC8"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-WP7F4QKDC8', { 'anonymize_ip': true});
</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
<meta property="og:title" content="Stat 20 - Randomized Experiments">
<meta property="og:description" content="Principles of experimental design">
<meta property="og:image" content="https://stat20.berkeley.edu/summer-2024/5-causation/02-experiments/assets/stat20-hex.png">
<meta property="og:site_name" content="Stat 20">
<meta name="twitter:title" content="Stat 20 - Randomized Experiments">
<meta name="twitter:description" content="Principles of experimental design">
<meta name="twitter:image" content="https://stat20.berkeley.edu/summer-2024/5-causation/02-experiments/assets/stat20-hex.png">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-sm " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/stat20-hex-small.png" alt="Stat 20 logo" class="navbar-logo"></a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../syllabus.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../office-hours.html"> 
<span class="menu-text">Office Hours</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../notes.html"> 
<span class="menu-text">Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../assignments.html"> 
<span class="menu-text">Assignments</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools tools-wide">
    <a href="https://edstem.org/us/courses/51198" title="" class="quarto-navigation-tool px-1" aria-label="Ed Discussion Forum"><i class="bi bi-chat-fill"></i></a>
    <a href="https://www.gradescope.com/courses/693050" title="" class="quarto-navigation-tool px-1" aria-label="Gradescope"><i class="bi bi-bar-chart-fill"></i></a>
    <a href="https://stat20.datahub.berkeley.edu/" title="" class="quarto-navigation-tool px-1" aria-label="RStudio"><i class="bi bi-r-circle-fill"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#principles-of-experimental-design" id="toc-principles-of-experimental-design" class="nav-link active" data-scroll-target="#principles-of-experimental-design">Principles of Experimental Design</a>
  <ul class="collapse">
<li><a href="#control" id="toc-control" class="nav-link" data-scroll-target="#control">Control</a></li>
  <li><a href="#random-assignment" id="toc-random-assignment" class="nav-link" data-scroll-target="#random-assignment">Random Assignment</a></li>
  <li><a href="#replication" id="toc-replication" class="nav-link" data-scroll-target="#replication">Replication</a></li>
  <li><a href="#blinding" id="toc-blinding" class="nav-link" data-scroll-target="#blinding">Blinding</a></li>
  </ul>
</li>
  <li>
<a href="#using-additional-variables-in-experimental-design" id="toc-using-additional-variables-in-experimental-design" class="nav-link" data-scroll-target="#using-additional-variables-in-experimental-design">Using additional variables in experimental design</a>
  <ul class="collapse">
<li><a href="#covariates" id="toc-covariates" class="nav-link" data-scroll-target="#covariates">Covariates</a></li>
  <li><a href="#covariate-balance" id="toc-covariate-balance" class="nav-link" data-scroll-target="#covariate-balance">Covariate balance</a></li>
  <li><a href="#evaluating-covariate-balance-across-an-experiment" id="toc-evaluating-covariate-balance-across-an-experiment" class="nav-link" data-scroll-target="#evaluating-covariate-balance-across-an-experiment">Evaluating covariate balance across an experiment</a></li>
  </ul>
</li>
  <li><a href="#the-ideas-in-code" id="toc-the-ideas-in-code" class="nav-link" data-scroll-target="#the-ideas-in-code">The Ideas in Code</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="notes.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">Randomized Experiments</h1>
<p class="subtitle lead">Principles of experimental design</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><!-- Lead out with running example: are you reading these notes as a website or are you reading them as a pdf on a tablet? Do you think your choice in this regard will affect your understanding of the material and the course --><p><span class="dropcap">C</span>ausation has a tricky relationship with data. We can’t observe the precise counterfactual that would allow us to identify an individual cause. Instead, statisticians use a host of methods to find a good approximation of the counterfactual, usually by focusing on a group-level quantity called an average treatment effect.</p>
<p>We now introduce the most important tool for approximating group-level counterfactuals, the randomized experiment.<br><!--In the last set of notes, randomized experimentation was presented as a method
for approximating group-level counterfactuals.  Randomized experimentation is a 
powerful idea but doesn't always work perfectly in practice.  In this set of notes, we will explore a tool called covariate balance which allows us to check how well
randomized assignment is working.  It will also help us evaluate causal claims 
in cases where researchers were not able to perform an experiment.--></p>
<section id="principles-of-experimental-design" class="level2"><h2 class="anchored" data-anchor-id="principles-of-experimental-design">Principles of Experimental Design</h2>
<p>An experiment is generally characterized as being a setting where the researcher actively assigns subjects or units to one particular condition or another. The most potent design of an experiment to determine whether one variable, the <em>treatment</em>, affects the outcome at the group level is the aptly named <em>Randomized Controlled Trial (RCT)</em>.</p>
<p>As a running example, consider an immediately relevant question: would reading these notes as a PDF lead to a deeper understanding and a correspondingly better score on the final exam than reading them as a webpage? Let’s run through each term one-by-one to think through how to design an RCT and effectively answers this question.</p>
<section id="control" class="level3"><h3 class="anchored" data-anchor-id="control">Control</h3>
<dl>
<dt><strong>Control</strong></dt>
<dd>
(noun) A second condition to which a subject or unit could be assigned that draws a contrast with the treatment condition.
</dd>
<dd>
<p>(verb) Actions taken to eliminate other possible causal factors and ensure that the only difference between the treatment and control group is the factor of interest.</p>
</dd>
</dl>
<p>When designing an RCT, an essential decision is the nature of your control group. Our research question is: will reading these notes as a webpage result in a deeper understanding? Deeper . . . than what? Deeper than if you didn’t read the notes at all? Deeper than if you read them aloud?</p>
<p>If we’re most interested in the difference between reading the notes as a webpage and reading them as a pdf, we could declare those who read the pdf part of the control group and those who read the pdf as part of the treatment group. Small changes to the control group can make an important difference in the precise question that you’ll be answering.</p>
<p>We can visualize the distinction between the two groups in a small example with three people in the control group (pdf) and three people in the treatment group (website).</p>
<div class="cell">
<div class="cell-output-display">
<div id="hbnbpwxpjj" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#hbnbpwxpjj table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#hbnbpwxpjj thead, #hbnbpwxpjj tbody, #hbnbpwxpjj tfoot, #hbnbpwxpjj tr, #hbnbpwxpjj td, #hbnbpwxpjj th {
  border-style: none;
}

#hbnbpwxpjj p {
  margin: 0;
  padding: 0;
}

#hbnbpwxpjj .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hbnbpwxpjj .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#hbnbpwxpjj .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hbnbpwxpjj .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hbnbpwxpjj .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hbnbpwxpjj .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hbnbpwxpjj .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hbnbpwxpjj .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hbnbpwxpjj .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hbnbpwxpjj .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hbnbpwxpjj .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hbnbpwxpjj .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hbnbpwxpjj .gt_spanner_row {
  border-bottom-style: hidden;
}

#hbnbpwxpjj .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#hbnbpwxpjj .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hbnbpwxpjj .gt_from_md > :first-child {
  margin-top: 0;
}

#hbnbpwxpjj .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hbnbpwxpjj .gt_row {
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hbnbpwxpjj .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hbnbpwxpjj .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hbnbpwxpjj .gt_row_group_first td {
  border-top-width: 2px;
}

#hbnbpwxpjj .gt_row_group_first th {
  border-top-width: 2px;
}

#hbnbpwxpjj .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hbnbpwxpjj .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hbnbpwxpjj .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hbnbpwxpjj .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hbnbpwxpjj .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hbnbpwxpjj .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hbnbpwxpjj .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#hbnbpwxpjj .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#hbnbpwxpjj .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hbnbpwxpjj .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hbnbpwxpjj .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hbnbpwxpjj .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hbnbpwxpjj .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hbnbpwxpjj .gt_left {
  text-align: left;
}

#hbnbpwxpjj .gt_center {
  text-align: center;
}

#hbnbpwxpjj .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hbnbpwxpjj .gt_font_normal {
  font-weight: normal;
}

#hbnbpwxpjj .gt_font_bold {
  font-weight: bold;
}

#hbnbpwxpjj .gt_font_italic {
  font-style: italic;
}

#hbnbpwxpjj .gt_super {
  font-size: 65%;
}

#hbnbpwxpjj .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#hbnbpwxpjj .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hbnbpwxpjj .gt_indent_1 {
  text-indent: 5px;
}

#hbnbpwxpjj .gt_indent_2 {
  text-indent: 10px;
}

#hbnbpwxpjj .gt_indent_3 {
  text-indent: 15px;
}

#hbnbpwxpjj .gt_indent_4 {
  text-indent: 20px;
}

#hbnbpwxpjj .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead><tr class="header gt_col_headings">
<th id="name" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">name</th>
<th id="group" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">group</th>
<th id="understanding" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">understanding</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="name" style="background-color: #FAFAD2">Evelyn</td>
<td class="gt_row gt_left" headers="group" style="background-color: #FAFAD2">pdf</td>
<td class="gt_row gt_left" headers="understanding" style="background-color: #FAFAD2">deep</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="name" style="background-color: #FAFAD2">Grace</td>
<td class="gt_row gt_left" headers="group" style="background-color: #FAFAD2">pdf</td>
<td class="gt_row gt_left" headers="understanding" style="background-color: #FAFAD2">shallow</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="name" style="background-color: #FAFAD2">Juan</td>
<td class="gt_row gt_left" headers="group" style="background-color: #FAFAD2">pdf</td>
<td class="gt_row gt_left" headers="understanding" style="background-color: #FAFAD2">deep</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="name" style="background-color: #E0FFFF">Alex</td>
<td class="gt_row gt_left" headers="group" style="background-color: #E0FFFF">website</td>
<td class="gt_row gt_left" headers="understanding" style="background-color: #E0FFFF">deep</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="name" style="background-color: #E0FFFF">Monica</td>
<td class="gt_row gt_left" headers="group" style="background-color: #E0FFFF">website</td>
<td class="gt_row gt_left" headers="understanding" style="background-color: #E0FFFF">shallow</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="name" style="background-color: #E0FFFF">Sriya</td>
<td class="gt_row gt_left" headers="group" style="background-color: #E0FFFF">website</td>
<td class="gt_row gt_left" headers="understanding" style="background-color: #E0FFFF">shallow</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<!--Given a dataset like this, we already know how to compute a difference
in proportions and conduct a hypothesis test to see whether reader format
and understanding are associated.  -->
<!--```{r}
library(infer)
set.seed(2024-3-25)
obs_stat <- format_data |>
   specify(response = understanding,
          explanatory = group,
          success = "deep") |>
  calculate(stat = "diff in props", order = c("website","pdf"))

null <- format_data |>
  specify(response = understanding,
          explanatory = group,
          success = "deep") |>
  hypothesize(null = "independence") |>
  generate(reps = 500, type = "permute") |>
  calculate(stat = "diff in props", order = c("website","pdf"))

null |>
  visualize() +
  shade_p_value(obs_stat, direction = 'both')
  
null |> get_p_value(obs_stat, direction = 'both')

```-->
<p>The process of computing a difference in proportions and conducting a hypothesis test for this dataset is no different than in the examples from the generalization notes. What makes this study special is the process that generated this data. Because this was a randomized controlled experiment, the difference in proportions provides a good estimate of the average treatment effect, and if it differs significantly from zero we have compelling evidence that reader format has a causal impact on understanding. We now describe some aspects of experimental design that help establish this stronger interpretation.</p>
</section><section id="random-assignment" class="level3"><h3 class="anchored" data-anchor-id="random-assignment">Random Assignment</h3>
<dl>
<dt><strong>Random Assignment</strong></dt>
<dd>
The process of assigning subjects to either the treatment or control group in a random fashion, where they’re equally likely to be assigned to each group.
</dd>
</dl>
<p>Because we are conducting an experiment, we are intervening in the process and directly assigning subjects to either the treatment (pdf readers) and control (website readers). There are many ways we could do this. The morning sections could all be assigned the pdf and the afternoon sections the website. Or the instructors could choose to exclusively assign either the pdf or the website version of the notes to their individual sections.</p>
<p>The problem with both of these approaches is that our two groups might differ on more characteristics than just their reading format. The morning sections perhaps have students who are early risers and more conscientious students. Or perhaps the instructors who choose the website are more tech-savvy and more effective at teaching computing. In both cases, we invite the skeptical observer to question whether it was truly the medium of the notes that led to a difference in course grades or if it was something else.</p>
<p>The mechanism of random assignment is brilliant because it can snuff out every such skeptical inquiry in one fell swoop. If instead we assigned each student to read the pdf or the website totally at random, every other possible characteristic between these groups should, on average, be balanced. If students are assigned at random, we’d expect an equal number of early-risers to be in both the pdf and the website group. We’d also expect the students with the more effective instructors to be evenly represented in both groups. And so on and so forth, for every possible other characteristic that might muddy the waters of our causal claim.</p>
</section><section id="replication" class="level3"><h3 class="anchored" data-anchor-id="replication">Replication</h3>
<dl>
<dt><strong>Replication</strong></dt>
<dd>
The practice of assigning multiple subjects to both the treatment and control group. Also, the practice of repeating an experiment a second time to see if the result is consistent.
</dd>
</dl>
<p>The careful reader will have noted a weakness in the brilliance of the random assignment mechanism for balancing the characteristics between the groups. What if, purely due to bad luck, we happen to randomly assign all of the early-risers to the pdf group and all of the late-risers to the website group? That would indeed bring us back to the problem of there being many ways in which our treatment group is different from our control group.</p>
<p>The random assignment mechanism will balance out all possible confounding factors <em>on average</em>, but for a given experiment that is not guaranteed. However, it becomes much more likely if we have a large sample size. If you just have four students total in the class, two of whom are early risers, it’s quite easy for both of them to end up in the pdf group if they were assigned at random. If instead you have 800 students, 400 of whom are early risers, it’s very very unlikely that all 400 will have made their way into the pdf group.</p>
</section><section id="blinding" class="level3"><h3 class="anchored" data-anchor-id="blinding">Blinding</h3>
<p>Randomized controlled trials have long been considered the gold standard for establishing a group-level causal claim, but care must be taken to ensure that your result means what you think it means. Here we reconsider a study where a new drug was used to treat heart attack patients. In particular, researchers wanted to know if the drug reduced deaths in patients.</p>
<p>These researchers designed a randomized control trial because they wanted to draw causal conclusions about the drug’s effect. Study volunteers were randomly assigned to one of two study groups. One group, the treatment group, received the drug. The control group did not receive any drug treatment.</p>
<p>Put yourself in the place of a person in the study. If you are in the treatment group, you are given a fancy new drug that you anticipate will help you. If you are in the control group, you are not treated at all but instead sit by idly, knowing you are missing out on potentially life-saving treatment. These perspectives suggest there are actually two effects in this study: the one of interest is the effectiveness of the drug, and the second is the emotional effect of (not) taking the drug, which is difficult to quantify. In order to control for the emotional effect of taking a drug, the researchers decide to hide from patients which group they are in.</p>
<dl>
<dt><strong>Blinding</strong></dt>
<dd>
The practice of keeping someone uninformed about which subjects in the study have been assigned to treatment.
</dd>
</dl>
<p>When researchers keep the patients uninformed about the treatments they will receive, the study is said to be <em>single-blind</em>. But there is one problem: if a patient does not receive a treatment, they will know they’re in the control group. A solution to this problem is to give a fake treatment to patients in the control group. This is called a <em>placebo</em>, and an effective placebo is the key to making a study truly blind. A classic example of a placebo is a sugar pill that is made to look like the actual treatment pill. However, offering such a fake treatment may not be ethical in certain experiments. For example, in medical experiments, typically the control group must get the current standard of care. Oftentimes, a placebo results in a slight but real improvement in patients. This effect has been dubbed the placebo effect.</p>
<p>The patients are not the only ones who should be blinded: doctors and researchers can also unintentionally affect the outcome. When a doctor knows a patient has been given the real treatment, they might inadvertently give that patient more attention or care than a patient that they know is on the placebo. To guard against this, which again has been found to have a measurable effect in some instances, most modern studies employ a <em>double-blind</em> setup where doctors or researchers who interact with patients are, just like the patients, unaware of who is or is not receiving the treatment.</p>
<!--## Job training

[clickbait thing about getting a job, e.g. reference to movie or offspring song
or American Psycho meme]

Unemployment is a complex social problem.  It is not always easy for unemployed individuals
to ``just get a job."  For example, employers may be wary of hiring someone without
a recent work history, and job-seekers without advanced training may be offered
only such low-paid, high-effort work that they prefer to
sit out the labor market entirely.  

One strategy governments and nonprofit organization have contemplated for getting
people into the labor market is job training programs.  The idea is to give public
assistance to
people who might otherwise struggle to get quality employment while they engage
in short-term work experiences that also give them employable skills (e.g. construction, painting
office work, or healthcare aides), boosting their incentive and ability to seek out
work on their own at the end of the program.  The causal claim associated with this strategy is that
participation in a job-training program causes increased wages and labor force
participation after the program's end.  

In the 1970s the US government decided to find out if this strategy actually works as intended, and they
commissioned a large randomized experiment called the National Supported Work Demonstration.  ALmost 10,000
individuals --- primarily women who had previously been on government welfare, 
individuals recovering from drug addiction, individuals with criminal records, and 
young people without professional credentials --- were enrolled, and half(?) of them
were randomized to receive a job training opportunity, while the others did not.
-->
<!-- https://www.ojp.gov/pdffiles1/Digitization/59202NCJRS.pdf-->
</section></section><section id="using-additional-variables-in-experimental-design" class="level2"><h2 class="anchored" data-anchor-id="using-additional-variables-in-experimental-design">Using additional variables in experimental design</h2>
<section id="covariates" class="level3"><h3 class="anchored" data-anchor-id="covariates">Covariates</h3>
<p>Let’s return to our hypothetical pdf vs.&nbsp;website experiment and imagine that in addition to our subject’s names and understanding level we were able to collect some additional information about each of them.</p>
<div class="cell">
<div class="cell-output-display">
<div id="ahcosvuspy" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ahcosvuspy table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ahcosvuspy thead, #ahcosvuspy tbody, #ahcosvuspy tfoot, #ahcosvuspy tr, #ahcosvuspy td, #ahcosvuspy th {
  border-style: none;
}

#ahcosvuspy p {
  margin: 0;
  padding: 0;
}

#ahcosvuspy .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ahcosvuspy .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ahcosvuspy .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ahcosvuspy .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ahcosvuspy .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ahcosvuspy .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ahcosvuspy .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ahcosvuspy .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ahcosvuspy .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ahcosvuspy .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ahcosvuspy .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ahcosvuspy .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ahcosvuspy .gt_spanner_row {
  border-bottom-style: hidden;
}

#ahcosvuspy .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ahcosvuspy .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ahcosvuspy .gt_from_md > :first-child {
  margin-top: 0;
}

#ahcosvuspy .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ahcosvuspy .gt_row {
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ahcosvuspy .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ahcosvuspy .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ahcosvuspy .gt_row_group_first td {
  border-top-width: 2px;
}

#ahcosvuspy .gt_row_group_first th {
  border-top-width: 2px;
}

#ahcosvuspy .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ahcosvuspy .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ahcosvuspy .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ahcosvuspy .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ahcosvuspy .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ahcosvuspy .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ahcosvuspy .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ahcosvuspy .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ahcosvuspy .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ahcosvuspy .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ahcosvuspy .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ahcosvuspy .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ahcosvuspy .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ahcosvuspy .gt_left {
  text-align: left;
}

#ahcosvuspy .gt_center {
  text-align: center;
}

#ahcosvuspy .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ahcosvuspy .gt_font_normal {
  font-weight: normal;
}

#ahcosvuspy .gt_font_bold {
  font-weight: bold;
}

#ahcosvuspy .gt_font_italic {
  font-style: italic;
}

#ahcosvuspy .gt_super {
  font-size: 65%;
}

#ahcosvuspy .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ahcosvuspy .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ahcosvuspy .gt_indent_1 {
  text-indent: 5px;
}

#ahcosvuspy .gt_indent_2 {
  text-indent: 10px;
}

#ahcosvuspy .gt_indent_3 {
  text-indent: 15px;
}

#ahcosvuspy .gt_indent_4 {
  text-indent: 20px;
}

#ahcosvuspy .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead><tr class="header gt_col_headings">
<th id="name" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">name</th>
<th id="group" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">group</th>
<th id="understanding" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">understanding</th>
<th id="major" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">major</th>
<th id="GPA" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">GPA</th>
<th id="native_speaker" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">native_speaker</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="name" style="background-color: #FAFAD2">Evelyn</td>
<td class="gt_row gt_left" headers="group" style="background-color: #FAFAD2">pdf</td>
<td class="gt_row gt_left" headers="understanding" style="background-color: #FAFAD2">deep</td>
<td class="gt_row gt_left" headers="major" style="background-color: #FAFAD2">Statistics</td>
<td class="gt_row gt_right" headers="GPA" style="background-color: #FAFAD2">3.81</td>
<td class="gt_row gt_left" headers="native_speaker" style="background-color: #FAFAD2">Yes</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="name" style="background-color: #FAFAD2">Grace</td>
<td class="gt_row gt_left" headers="group" style="background-color: #FAFAD2">pdf</td>
<td class="gt_row gt_left" headers="understanding" style="background-color: #FAFAD2">shallow</td>
<td class="gt_row gt_left" headers="major" style="background-color: #FAFAD2">Economics</td>
<td class="gt_row gt_right" headers="GPA" style="background-color: #FAFAD2">3.63</td>
<td class="gt_row gt_left" headers="native_speaker" style="background-color: #FAFAD2">No</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="name" style="background-color: #FAFAD2">Juan</td>
<td class="gt_row gt_left" headers="group" style="background-color: #FAFAD2">pdf</td>
<td class="gt_row gt_left" headers="understanding" style="background-color: #FAFAD2">deep</td>
<td class="gt_row gt_left" headers="major" style="background-color: #FAFAD2">Economics</td>
<td class="gt_row gt_right" headers="GPA" style="background-color: #FAFAD2">3.20</td>
<td class="gt_row gt_left" headers="native_speaker" style="background-color: #FAFAD2">Yes</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="name" style="background-color: #E0FFFF">Alex</td>
<td class="gt_row gt_left" headers="group" style="background-color: #E0FFFF">website</td>
<td class="gt_row gt_left" headers="understanding" style="background-color: #E0FFFF">deep</td>
<td class="gt_row gt_left" headers="major" style="background-color: #E0FFFF">Statistics</td>
<td class="gt_row gt_right" headers="GPA" style="background-color: #E0FFFF">2.85</td>
<td class="gt_row gt_left" headers="native_speaker" style="background-color: #E0FFFF">No</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="name" style="background-color: #E0FFFF">Monica</td>
<td class="gt_row gt_left" headers="group" style="background-color: #E0FFFF">website</td>
<td class="gt_row gt_left" headers="understanding" style="background-color: #E0FFFF">shallow</td>
<td class="gt_row gt_left" headers="major" style="background-color: #E0FFFF">Economics</td>
<td class="gt_row gt_right" headers="GPA" style="background-color: #E0FFFF">3.19</td>
<td class="gt_row gt_left" headers="native_speaker" style="background-color: #E0FFFF">Yes</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="name" style="background-color: #E0FFFF">Sriya</td>
<td class="gt_row gt_left" headers="group" style="background-color: #E0FFFF">website</td>
<td class="gt_row gt_left" headers="understanding" style="background-color: #E0FFFF">shallow</td>
<td class="gt_row gt_left" headers="major" style="background-color: #E0FFFF">Statistics</td>
<td class="gt_row gt_right" headers="GPA" style="background-color: #E0FFFF">3.80</td>
<td class="gt_row gt_left" headers="native_speaker" style="background-color: #E0FFFF">Yes</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We introduce a new term to draw an important distinction based on when these additional variables were collected.</p>
<dl>
<dt><strong>Covariate</strong></dt>
<dd>
A variable collected in a randomized experiment that was measured or determined prior to administering the treatment.
</dd>
</dl>
<p>Notice that covariates cannot be affected by the treatment since they were measured first. Variables measured after treatment, including the outcome variable, may be affected by the treatment. <!--f these v were collected
before or after treatment assignment was determined.  Variables measured or 
determined in value before treatment assignment --- --> In our example, it’s reasonable to imagine that major, GPA, and native speaker status could all have been measured prior to the assignment, so they are covariates.</p>
<!--It 
is natural to ask why the government bothered collecting this data.  From the last 
set of notes, we already know how to estimate the ATE using the  treatment and the outcome
alone.-->
</section><section id="covariate-balance" class="level3"><h3 class="anchored" data-anchor-id="covariate-balance">Covariate balance</h3>
<p>Note that many of these covariates seem likely to be associated with the outcome. For example, students with a higher GPA may be more committed to doing class readings and be more likely to gain a deep understanding regardless of format. If one group had more high-GPA students, that group might look like it had benefited from its reading format even if there were no difference between the formats for any single student. This motivates us to look for a quality called balance.</p>
<dl>
<dt><strong>Covariate balance</strong></dt>
<dd>
A covariate is balanced if its empirical distribution in the treated group is similar to its empirical distribution in the control group.
</dd>
</dl>
<p>On the other hand, if the distributions are very different between the treatment group and the control group, we say that the covariate is imbalanced.</p>
<p>There is a close link between covariate balance and randomized treatment assignment. Because treatment is randomly assigned with equal probability for each individual in our study, there is no way it should be able to systematically move higher-GPA students into one of the two groups. The same is true of all our other covariates. Thus we expect randomization to balance our covariates in general.</p>
<!--in the treatment group and in the
control group.-->
<p>To check the balance of our GPA variable we can calculate a measure of difference between groups for a single covariate <span class="math inline">\(x\)</span>:</p>
<p><span class="math display">\[
SMD(x) = \frac{\overline{x}_{treatment} - \overline{x}_{control}}{\sqrt{\frac{1}{2}\widehat{\sigma}_{treatment}^2 + \frac{1}{2}\widehat{\sigma}_{control}^2}}
\]</span></p>
<p>This quantity is called the standardized mean difference or SMD. The numerator is just the difference in means (subtracting the control mean from the treated mean). To make the differences in means comparable across variables with very different scales, we divide by a `pooled’ standard error estimate which comes from averaging the sample variances of the covariate in the two groups and taking its square error. For GPA in our data frame above, the difference in means between groups is 3.28 <span class="math inline">\(-\)</span> 3.55 <span class="math inline">\(=\)</span> -0.27 and the pooled standard error is 0.41, so the SMD is <!---0.27/0.41 $=$--> -0.66.</p>
</section><section id="evaluating-covariate-balance-across-an-experiment" class="level3"><h3 class="anchored" data-anchor-id="evaluating-covariate-balance-across-an-experiment">Evaluating covariate balance across an experiment</h3>
<p>To get a quick look at balance across all our variables, we can create a <strong>Love plot</strong>:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The Love plot displays standardized mean differences (on a common scale on the x-axis) for all the covariates in our study, highlighting which covariates are most different between groups and in which direction.</p>
<p>Clearly in our experiment not all variables are perfectly balanced. This alone isn’t a red flag — after all, randomized experiments only balance covariates on average, and some small differences are expected — but it can be challenging to determine whether the differences are big enough to matter, especially in a study this small.</p>
<p>One way to address this problem is by using hypothesis tests. For each covariate, we can test the null hypothesis that this covariate is independent of treatment and produce a p-value. In practice this is just like the tests from the generalization unit, but it uses the covariate in the test statistic instead of the outcome. Here we conduct this test for GPA.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The p-value is 0.396. Clearly the difference in means we observed for GPA is not unexpected under random treatment assignment given our small sample size. Note that although our ultimate project here is investigating a causal claim, this particular step is an example of generalization: based on the particular set of treatment assignments we see in this dataset (the sample), we are making a claim about the broader process that generated the treatment assignments.</p>
<!--Our null hypothesis is that treatment is independent of every one of the 
covariates.  If we were focusing on a single covariate, the SMD would be a good
test statistic, but it would be nice to bring together all the information across
our covariates.  To do so, we'll apply some of our tools for prediction.  If 
covariates look systematically different across the groups, it should be possible
to guess with high accuracy which group a subject is in based on their covariate
values. So we will fit an ordinary regression model to predict treatment status
using all our covariates.  Letting $z_i$ represent treatment status for subject
$i$ and $\widehat{z}_i$ represent our predicted value for subject $i$'s treatment 
status based on $k$ covariates, we will compute the following test 
statistic:-->
<!--This is known as an F-statistic and is used more generally to compare how
much better a regression models predicts than using the sample mean (relative to the
amount of noise).  [^Fstat]. It will tend to be close to 1 when the covariates are not
helpful for predicting treatment status and much larger when they are useful.-->
<!--[^Fstat] The formula for the F-statistic may not seem very intuitive.  -->
<!--We can use the following \texttt{infer} pipeline to conduct the test in the 
pdf vs. website problem:


::: {.cell}

```{.r .cell-code}
obs_F <- format_data |>
  mutate(is_website = as.numeric(group == 'website')) |>
  specify(is_website ~ major + GPA + native_speaker) |>
  fit()
```
:::


Notice that the null distribution is very coarse here because there are only
$\left(\begin{array}{c} 6 \\ 3 \end{array}\right)$ unique treatment assignments,
and that we conduct a one-tailed test (since our test statistic takes on large
values when the null hypothesis is false).-->
<!--### What if large imbalances are present?-->
<p>One of the most important reasons to check covariate balance is to catch problems with how the experiment was run. Suppose that we’d intended to sort a spreadsheet in a random order and assign the top half of the subjects to pdf, but that by accident we sorted on GPA instead of randomly. In this case our covariate balance test would likely have rejected the null hypothesis that treatment was randomly assigned, allowing us to catch the issue. For this reason it is often a good idea to check balance before actually running the experiment!</p>
<!-- In our example, there is no particular evidence of improper randomization.  
 However, it may still bother us that the pdf group has a mean GPA of 3.55 
 while the website group has a mean GPA of 3.28.  Even if this imbalance is
 the result of bad luck rather than systematic bad randomization it may still
 undermine our claims.  For this reason, instead of using a simple difference
 in proportions to estimate the ATE in this study, we may prefer to fit a multiple
 least squares regression model that includes both GPA and reader format, and use
 the coefficient of reader as our estimate [^linkfun].-->
<!--```{r}
obs_reg <- format_data |>
  mutate(deep_understanding = as.numeric(understanding == 'deep')) |>
  specify(deep_understanding ~ group + GPA ) |>
  fit()

null_reg <- format_data |>
  mutate(deep_understanding = as.numeric(understanding == 'deep')) |>
  specify(deep_understanding ~ group + GPA ) |>
  hypothesize(null = 'independence') |>
  generate(reps = 500, type = "permute") |>
  fit()

visualize(null_reg) +
  shade_p_value(obs_reg, direction = 'both')

get_p_value(null_reg, obs_reg, direction = 'both')

```-->
<!--Although this pipeline gives us coefficients and estimates for the GPA 
coefficient and the intercept we only care about the coefficient of the treatment
our study set out to measure, in this case ``groupwebsite."  From the plot we
can see that the ATE estimate using regression is slightly larger in magnitude
than the ATE estimate using the difference in proportions, but neither estimate
looks significantly different from zero.-->
<!--[^linkfun]: It may seem odd to fit a multiple least-squares regression to a binary
outcome like whether understanding is deep rather than a logistic regression as 
we might have in the prediction unit.  The reason we do it is because we care
about extracting and interpreting the model's coefficients rather than its predictions.  
Logistic regression coefficients have a complex nonlinear relationship with the
outcome variable and don't provide good estimates for the ATE in general.
<!--is good for prediction, but its coefficients are harder to interpret and do not
correspond-->
<!--MOVE THIS PARAGRAPH TO FOOTNOTE? Of course, a better way to deal with the issue of GPA balance is to run your
experiment on students who all have near-identical GPAs, or divide your students
into several subgroups each with near-identical GPAS and assign equal numbers of 
treatment and control subjects in each group.  This is known as blocking and 
ensures good balance, although it can be complicated to do in practice and cannot
be done for many variables at once.-->
</section></section><section id="the-ideas-in-code" class="level2"><h2 class="anchored" data-anchor-id="the-ideas-in-code">The Ideas in Code</h2>
<p>First we create a data frame to store the pdf vs.&nbsp;website data. ::: {.cell}</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">format_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Evelyn"</span>, <span class="st">"Grace"</span>, <span class="st">"Juan"</span>, <span class="st">"Alex"</span>, <span class="st">"Monica"</span>, <span class="st">"Sriya"</span><span class="op">)</span>,</span>
<span>                 group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"pdf"</span>, <span class="st">"pdf"</span>, <span class="st">"pdf"</span>, <span class="st">"website"</span>, <span class="st">"website"</span>, <span class="st">"website"</span><span class="op">)</span>,</span>
<span>                 understanding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"deep"</span>, <span class="st">"shallow"</span>, <span class="st">"deep"</span>, <span class="st">"deep"</span>, <span class="st">"shallow"</span>, </span>
<span>                                   <span class="st">"shallow"</span><span class="op">)</span>,</span>
<span>                 major <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Statistics'</span>, <span class="st">'Economics'</span>, <span class="st">'Economics'</span>, <span class="st">'Statistics'</span>, </span>
<span>                           <span class="st">'Economics'</span>, <span class="st">'Statistics'</span><span class="op">)</span>,</span>
<span>                 GPA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3.81</span>, <span class="fl">3.63</span>, <span class="fl">3.20</span>, <span class="fl">2.85</span>, <span class="fl">3.19</span>, <span class="fl">3.80</span><span class="op">)</span>,</span>
<span>                 native_speaker <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Yes'</span>,<span class="st">'No'</span>,<span class="st">'Yes'</span>,<span class="st">'No'</span>,<span class="st">'Yes'</span>,<span class="st">'Yes'</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>:::</p>
<p>The <code>cobalt</code> package in R contains the function <code>bal.tab</code> to create tables of standardized differences. By passing its output to <code>plot</code> you can create a Love plot. Note that <code>cobalt</code> expect treatment variables to be numeric or logical, so we begin by converting <code>group</code> to the logical variable <code>is_website1</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ngreifer.github.io/cobalt/">cobalt</a></span><span class="op">)</span></span>
<span><span class="va">format_data</span> <span class="op">&lt;-</span> <span class="va">format_data</span> <span class="op">|&gt;</span></span>
<span>                <span class="fu">mutate</span><span class="op">(</span>is_website <span class="op">=</span> <span class="va">group</span> <span class="op">==</span> <span class="st">'website'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html">bal.tab</a></span><span class="op">(</span><span class="va">is_website</span> <span class="op">~</span> <span class="va">major</span> <span class="op">+</span> <span class="va">GPA</span> <span class="op">+</span> <span class="va">native_speaker</span>, data <span class="op">=</span> <span class="va">format_data</span>,</span>
<span>        s.d.denom <span class="op">=</span> <span class="st">'pooled'</span>, binary <span class="op">=</span> <span class="st">'std'</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Running balance tests uses infer much like we did in the generalization unit. The covariate for which we are testing balance is the response and the treatment is the explanatory variable.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/infer">infer</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2024</span><span class="op">-</span><span class="fl">3</span><span class="op">-</span><span class="fl">25</span><span class="op">)</span></span>
<span><span class="va">obs_stat</span> <span class="op">&lt;-</span> <span class="va">format_data</span> <span class="op">|&gt;</span></span>
<span>   <span class="fu"><a href="https://infer.tidymodels.org/reference/specify.html">specify</a></span><span class="op">(</span>explanatory <span class="op">=</span> <span class="va">group</span>,</span>
<span>          response <span class="op">=</span> <span class="va">GPA</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://infer.tidymodels.org/reference/calculate.html">calculate</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"diff in means"</span>, order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"website"</span>,<span class="st">"pdf"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">null</span> <span class="op">&lt;-</span> <span class="va">format_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://infer.tidymodels.org/reference/specify.html">specify</a></span><span class="op">(</span>response <span class="op">=</span> <span class="va">GPA</span>,</span>
<span>          explanatory <span class="op">=</span> <span class="va">group</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://infer.tidymodels.org/reference/hypothesize.html">hypothesize</a></span><span class="op">(</span>null <span class="op">=</span> <span class="st">"independence"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://infer.tidymodels.org/reference/generate.html">generate</a></span><span class="op">(</span>reps <span class="op">=</span> <span class="fl">500</span>, type <span class="op">=</span> <span class="st">"permute"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://infer.tidymodels.org/reference/calculate.html">calculate</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"diff in means"</span>, order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"website"</span>,<span class="st">"pdf"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">null</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://infer.tidymodels.org/reference/visualize.html">visualize</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://infer.tidymodels.org/reference/shade_p_value.html">shade_p_value</a></span><span class="op">(</span><span class="va">obs_stat</span>, direction <span class="op">=</span> <span class="st">'both'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="notes_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="summary" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>You may heard the phrase “Correlation does not imply causation … unless it’s seen in data from a randomized control trial.” While it is sometimes possible to make compelling causal claims from correlations found in data - a topic we will explore in depth next week - it does highlight the particular strength of RCTs. RCTs are able to isolate the effect of interest by creating a carefully selected control group and then assigning subjects to groups at random. By using a large number of replicates and checking balance on measured covariates we can demonstrate convincingly that our control group on average serves as a close counterfactual to our treatment group.</p>
<div class="page-columns page-full"><p></p><div class="no-row-height column-margin column-container"><span class=""></span></div></div>
<!-- [^scurvy]: This tale is recounted in full in "Scurvy, sailors, and science", Duncan P. Thomas in the Journal of the Royal Society of Medicine 1997; 90:50-54. -->
<!-- A future potential source of questions: -->
<!-- - what would a study look like if it did *not* have a control? (Queen Charlotte inoculating all of the prisoners in Newgate prison in London) what is the problem? -->
<!-- - what would a study look like if it were *not* randomized? (Lind's Scurvy Trials) -->


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item">
    <a class="nav-link" href="../../license.html">
<p>License</p>
</a>
  </li>  
</ul>
</div>
  </div>
</footer>


</body></html>