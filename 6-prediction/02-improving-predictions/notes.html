<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Stat 20 - Evaluating and Improving Predictions</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../6-prediction/03-overfitting/notes.html" rel="next">
<link href="../../6-prediction/01-method-of-least-squares/notes.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
<meta property="og:title" content="Stat 20 - Evaluating and Improving Predictions">
<meta property="og:description" content="\(R^2\), Adding Predictors, Transformations, and Polynomials">
<meta property="og:image" content="https://www.stat20.org/6-prediction/02-improving-predictions/images/polynomial.png">
<meta property="og:site_name" content="Stat 20">
<meta property="og:image:height" content="252">
<meta property="og:image:width" content="346">
<meta name="twitter:title" content="Stat 20 - Evaluating and Improving Predictions">
<meta name="twitter:description" content="\(R^2\), Adding Predictors, Transformations, and Polynomials">
<meta name="twitter:image" content="https://www.stat20.org/6-prediction/02-improving-predictions/images/polynomial.png">
<meta name="twitter:image-height" content="252">
<meta name="twitter:image-width" content="346">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="nav-sidebar floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-sm " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/stat20-hex-small.png" alt="Stat 20 logo" class="navbar-logo"></a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../syllabus.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../office-hours.html"> 
<span class="menu-text">Office Hours</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../../notes.html" aria-current="page"> 
<span class="menu-text">Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../assignments.html"> 
<span class="menu-text">Assignments</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools tools-wide">
    <a href="https://edstem.org/us/courses/51198" title="" class="quarto-navigation-tool px-1" aria-label="Ed Discussion Forum"><i class="bi bi-chat-fill"></i></a>
    <a href="https://www.gradescope.com/courses/693050" title="" class="quarto-navigation-tool px-1" aria-label="Gradescope"><i class="bi bi-bar-chart-fill"></i></a>
    <a href="https://stat20.datahub.berkeley.edu/" title="" class="quarto-navigation-tool px-1" aria-label="RStudio"><i class="bi bi-r-circle-fill"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../6-prediction/02-improving-predictions/notes.html">Evaluating and Improving Predictions</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../1-questions-and-data/01-understanding-the-world/notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Understanding the World with Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../1-questions-and-data/02-taxonomy-of-data/notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Taxonomy of Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../2-summarizing-data/01-summarizing-categorical-data/notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summarizing Categorical Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../2-summarizing-data/02-summarizing-numerical-data/notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summarizing Numerical Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../2-summarizing-data/04-conditioning/notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Pipelines</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../2-summarizing-data/03-a-grammar-of-graphics/notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Grammar of Graphics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../2-summarizing-data/06-summarizing-associations/notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summarizing Numerical Associations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../2-summarizing-data/07-multiple-linear-regression/notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multiple Linear Regression</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../3-probability/01-chance-intro/notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introducing Probability</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../3-probability/02-cond-prob-indep/notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Computing Probabilities</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../3-probability/03-probability-dsns/notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probability Distributions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../3-probability/04-random-variables/notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Random Variables</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../3-probability/05-ev-se/notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Expected value and variance of a random variable</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../3-probability/06-normal-approx/notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Continuous Distributions and Normal Approximations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../4-generalization/01-sampling-distributions/notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">From Samples to Populations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../4-generalization/02-confidence-intervals/notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Confidence Intervals</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../4-generalization/03-bootstrapping/notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bootstrapping</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../4-generalization/04-hypothesis-tests/notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hypothesis Testing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../4-generalization/05-hypothesis-tests-2/notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hypothesis Tests II</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../4-generalization/06-wrong-by-design/notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Wrong by Design</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../6-prediction/01-method-of-least-squares/notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Method of Least Squares</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../6-prediction/02-improving-predictions/notes.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Evaluating and Improving Predictions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../6-prediction/03-overfitting/notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overfitting</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../6-prediction/05-logistic-regression/notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Logistic Regression</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../5-causation/01-defining-causality/notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Defining Causality</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../5-causation/02-experiments/notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Randomized Experiments</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../5-causation/03-matching/notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Causal Effects in Observational Studies</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../5-causation/04-time/notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using Time to Measure Causal Effects</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#evaluating-the-fit-to-your-data" id="toc-evaluating-the-fit-to-your-data" class="nav-link active" data-scroll-target="#evaluating-the-fit-to-your-data">Evaluating the fit to your data</a>
  <ul class="collapse">
<li><a href="#measuring-explanatory-power-r2" id="toc-measuring-explanatory-power-r2" class="nav-link" data-scroll-target="#measuring-explanatory-power-r2">Measuring explanatory power: <span class="math inline">\(R^2\)</span></a></li>
  </ul>
</li>
  <li>
<a href="#improving-predictions" id="toc-improving-predictions" class="nav-link" data-scroll-target="#improving-predictions">Improving predictions</a>
  <ul class="collapse">
<li><a href="#adding-predictors" id="toc-adding-predictors" class="nav-link" data-scroll-target="#adding-predictors">Adding Predictors</a></li>
  <li><a href="#non-linear-transformation" id="toc-non-linear-transformation" class="nav-link" data-scroll-target="#non-linear-transformation">Non-linear transformation</a></li>
  <li><a href="#polynomials" id="toc-polynomials" class="nav-link" data-scroll-target="#polynomials">Polynomials</a></li>
  </ul>
</li>
  <li>
<a href="#the-ideas-in-code" id="toc-the-ideas-in-code" class="nav-link" data-scroll-target="#the-ideas-in-code">The Ideas in Code</a>
  <ul class="collapse">
<li><a href="#inspect-model-output-with-the-broom-library" id="toc-inspect-model-output-with-the-broom-library" class="nav-link" data-scroll-target="#inspect-model-output-with-the-broom-library">Inspect model output with the <code>broom</code> library</a></li>
  <li><a href="#fitting-polynomials-in-r-with-poly" id="toc-fitting-polynomials-in-r-with-poly" class="nav-link" data-scroll-target="#fitting-polynomials-in-r-with-poly">Fitting polynomials in R with <code>poly()</code></a></li>
  <li><a href="#making-predictions-on-a-new-observation-with-predict" id="toc-making-predictions-on-a-new-observation-with-predict" class="nav-link" data-scroll-target="#making-predictions-on-a-new-observation-with-predict">Making predictions on a new observation with <code>predict()</code></a></li>
  </ul>
</li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="notes.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">Evaluating and Improving Predictions</h1>
<p class="subtitle lead"><span class="math inline">\(R^2\)</span>, Adding Predictors, Transformations, and Polynomials</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p><span class="dropcap">I</span>n the last lecture we built our first prediction machine: a line drawn through a scatter plot that that minimizes the sum of squared residuals. In these lecture notes we focus on two questions: How can we evaluate the quality of our predictions? and How can we improve them?</p>
<section id="evaluating-the-fit-to-your-data" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="evaluating-the-fit-to-your-data">Evaluating the fit to your data</h2>
<p>Once you have fit a linear model to a scatter plot, you are able to answer questions such as:</p>
<blockquote class="blockquote">
<p>What graduation rate would you expect for a state with a poverty rate of 15%?</p>
</blockquote>
<p>Graphically, this can be done by drawing a vertical line from where the poverty rate is 15% and finding where that line intersects your linear model. If you trace from that intersection point horizontally to the y-axis, youâ€™ll find the predicted graduation rate.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="notes_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>From the plot above, we can tell that the model yields a prediction around roughly 82.5%. To be more precise, we could plug the x-value into our equation for the line and solve.</p>
<p><span class="math display">\[ \hat{y} = 96.2 + -0.89 \cdot 15 = 82.85 \]</span></p>
<p>So how good of a prediction is 82.85%? Until we observe a state with a poverty rate of 15%, weâ€™ll never know! What we <em>can</em> know, however, is how well our model explains the structure found in the data that we <em>have</em> observed. For those observations, we have both the predicted (or fitted) values <span class="math inline">\(\hat{y}_i\)</span> as well as their actual y-values <span class="math inline">\(y_i\)</span>. These can be used to calculate a statistic that measures the explanatory power of our model.</p>
<section id="measuring-explanatory-power-r2" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="measuring-explanatory-power-r2">Measuring explanatory power: <span class="math inline">\(R^2\)</span>
</h3>
<p><span class="math inline">\(R^2\)</span> is a statistic that captures how good the predictions from your linear model are (<span class="math inline">\(\hat{y}\)</span>) by comparing them another even simpler model: <span class="math inline">\(\bar{y}\)</span>. To understand how this statistic is constructed please watch this short video found in the Media Gallery on bCourses (14 minutes).</p>
<p><br></p>
<p><a href="https://bcourses.berkeley.edu/courses/1531766/external_tools/90481"><img src="images/r2-thumbnail.png" class="img-fluid" width="400"></a></p>
<p><br></p>
<dl>
<dt><strong>R-squared (<span class="math inline">\(R^2\)</span>)</strong></dt>
<dd>
<p>A statistic that measures the proportion of the total variability in the y-variable (total sum of squares, TSS) that is explained away using our model involving x (sum of squares due to regression, SSR).</p>
<p><span class="math display">\[R^2 = \frac{SSR}{TSS} = \frac{\sum_{i=1}^n (\hat{y}_i - \bar{y})^2}{\sum_{i=1}^n (y_i - \bar{y})^2}\]</span></p>
<p>Because the total variablity is composed of the explained and the unexplain variability, <span class="math inline">\(R^2\)</span> can be equivalent formulated as 1 minus the proportion of total variability that is <em>unexplained</em> by the model, which uses the more familiar residual sum of squares (RSS).</p>
<p><span class="math display">\[R^2 = 1 - \frac{RSS}{TSS} = 1 - \frac{\sum_{i=1}^n (y_i - \hat{y}_i)^2}{\sum_{i=1}^n (y_i - \bar{y})^2}\]</span></p>
<p><span class="math inline">\(R^2\)</span> has the following properties:</p>
<ol type="1">
<li>Always takes values between 0 and 1.</li>
<li>
<span class="math inline">\(R^2\)</span> near 1 means predictions were more accurate.</li>
<li>
<span class="math inline">\(R^2\)</span> near 0 means predictions were less accurate.</li>
</ol>
</dd>
</dl>

<div class="no-row-height column-margin column-container"><div class="">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/r-squared.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:1.8in"></p>
</figure>
</div>
</div></div><section id="example-poverty-and-graduation" class="level4"><h4 class="anchored" data-anchor-id="example-poverty-and-graduation">Example: Poverty and Graduation</h4>
<p>To fit the least squares linear regression model to predict graduation rate using the poverty rate, we turn to the familiar <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> function.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Graduates</span> <span class="op">~</span> <span class="va">Poverty</span>, data <span class="op">=</span> <span class="va">poverty</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For this particular model, <span class="math inline">\(R^2 = .56\)</span>. This means that poverty rate is able to explain about 56% of the variability found in graduation rates. Thatâ€™s a good start!</p>
</section></section></section><section id="improving-predictions" class="level2"><h2 class="anchored" data-anchor-id="improving-predictions">Improving predictions</h2>
<p><span class="math inline">\(R^2\)</span> allows us to quantify how well the model explains the structure found in the data set. From a model-building standpoint, it gives us a goal: to find a model with the highest possible <span class="math inline">\(R^2\)</span>. Here we outline three different methods for pursuing this goal - adding predictors, transformations, and polynomials - and weâ€™d look at a different data set for each one.</p>
<section id="adding-predictors" class="level3"><h3 class="anchored" data-anchor-id="adding-predictors">Adding Predictors</h3>
<p>Letâ€™s return to the data set that that we studying when we first learned about multiple linear regression: ratings of Italian restaurants from the ZAGAT guide. For each of the 168 restaurants in the data set, we have observations on the average price of a meal, the food quality, the quality of the decor, the quality of the service, and whether it is east or west of Fifth Avenue.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 168 Ã— 6
   restaurant          price  food decor service geo  
   &lt;chr&gt;               &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;
 1 Daniella Ristorante    43    22    18      20 west 
 2 Tello's Ristorante     32    20    19      19 west 
 3 Biricchino             34    21    13      18 west 
 4 Bottino                41    20    20      17 west 
 5 Da Umberto             54    24    19      21 west 
 6 Le Madri               52    22    22      21 west 
 7 Le Zie                 34    22    16      21 west 
 8 Pasticcio              34    20    18      21 east 
 9 Belluno                39    22    19      22 east 
10 Cinque Terre           44    21    17      19 east 
# â„¹ 158 more rows</code></pre>
</div>
</div>
<p>Maybe we want a model that will tell us how much we will have to spend at a new restaurant that is not upfront about its pricing; or maybe we just opened a new restaurant and want to know how much customers expect to spend. So price will serve as our response variable, leaving us four possible predictor variables. Letâ€™s fit four different regression models, each one incorporating more more information by adding a predictor.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">price</span> <span class="op">~</span> <span class="va">food</span>, data <span class="op">=</span> <span class="va">zagat</span><span class="op">)</span></span>
<span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">price</span> <span class="op">~</span> <span class="va">food</span> <span class="op">+</span> <span class="va">geo</span>, data <span class="op">=</span> <span class="va">zagat</span><span class="op">)</span></span>
<span><span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">price</span> <span class="op">~</span> <span class="va">food</span> <span class="op">+</span> <span class="va">geo</span> <span class="op">+</span> <span class="va">decor</span>, data <span class="op">=</span> <span class="va">zagat</span><span class="op">)</span></span>
<span><span class="va">m4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">price</span> <span class="op">~</span> <span class="va">food</span> <span class="op">+</span> <span class="va">geo</span> <span class="op">+</span> <span class="va">decor</span> <span class="op">+</span> <span class="va">service</span>, data <span class="op">=</span> <span class="va">zagat</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Unfortunately we canâ€™t visualize these four linear models as four lines on a scatterplot because only the first model describes a line. The second describes two parallel lines; the third describes two parallel planes in 3D; the fourth describes two parallel hyperplanes in 4D (ðŸ¤¯).</p>
<p>We can, however, compare these four models in an arena where theyâ€™re all on the same playing field: how well they predict price. To quantify that, we can calculate the <span class="math inline">\(R^2\)</span> value for each.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  model R_squared
1    m1 0.3931835
2    m2 0.3987720
3    m3 0.6278808
4    m4 0.6278809</code></pre>
</div>
</div>
<p>Observe that the more information we provide the model - by adding predictors - the greater the <span class="math inline">\(R^2\)</span> becomes! This is not a particular characteristic of the ZAGAT data set but of <span class="math inline">\(R^2\)</span> in general. Adding new predictors will never lower the <span class="math inline">\(R^2\)</span> of a model fit using least squares.</p>
</section><section id="non-linear-transformation" class="level3"><h3 class="anchored" data-anchor-id="non-linear-transformation">Non-linear transformation</h3>
<p>The world is not always linear. We can create <em>non-linear</em> prediction models by building off the above <em>linear model</em> machinery. To demonstrate how to use this approach to increase the predictive power of our model, weâ€™ll turn to a non-linear trend that should look familiarâ€¦</p>
<section id="a-single-non-linear-term" class="level4"><h4 class="anchored" data-anchor-id="a-single-non-linear-term">A single non-linear term</h4>
<p>Take a question from flights lab as an example where we plot the average airspeed vs.&nbsp;flight distance. First letâ€™s try fitting a linear model.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="notes_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>A linear model does not seem appropriate to model average speed from distance. There does appear to be a <em>monotonically increasing</em> trend, but it starts out steeper then flattens out<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. This trend is reminiscent of functions like <em>log</em> or <em>square root</em>.</p>
<p>Lets try transforming our predictor (distance) with the log function to create a new variable called <code>log_dist</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op">&lt;-</span> <span class="va">flights</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">mutate</span><span class="op">(</span>log_dist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">distance</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can then fit a linear model using this new <code>log_dist</code> variable as the predictor.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_speed_from_log_dist</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">avg_speed</span> <span class="op">~</span> <span class="va">log_dist</span>, data<span class="op">=</span><span class="va">flights</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Looking at the data below, we see there does seem to be a linear relationship between <code>avg_speed</code> and our new variable <code>log_dist</code>! Notice the x-axis in the below plot is <code>log_dist</code> whereas it was <code>distance</code> in the above plot.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="notes_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The linear model with <code>log_dist</code> (<span class="math inline">\(R^2=0.843\)</span>) predicts <code>avg_speed</code> better than the linear model with <code>distance</code> (<span class="math inline">\(R^2=0.72\)</span>)</p>
<p>We can now think of our predictive model as</p>
<p><span class="math display">\[
\widehat{y} = b_0 + b_1 \cdot \log(x)
\]</span></p>
<p>In other words, our model is <em>non-linear</em> since <span class="math inline">\(x\)</span> appears inside of a logarithm. We can plot the non-linear prediction function in the original predictor distance and we see the prediction function is curved!</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="notes_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>So is this a linear model or a non-linear model? Itâ€™s both. We created a new variable <code>log_dist</code> by transforming the original variable; the prediction function is a <strong>linear</strong> function of this new variable. But we can also think of this as a function of the original variable <code>distance</code>; the prediction function is a <strong>non-linear</strong> function of this original variable.</p>
</section></section><section id="polynomials" class="level3"><h3 class="anchored" data-anchor-id="polynomials">Polynomials</h3>
<p>Sometimes we need an more complex transformation than just a simple function (e.g.&nbsp;<span class="math inline">\(\sqrt{x}, \log(x),  x^2,...\)</span>). Take the following example where there is a strong association between x and y, but itâ€™s not linear (this data, admitted, was simulated in R).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="notes_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>So how should we model this? Polynomials to the rescue!</p>
<p>A <strong>polynomial</strong> is a function like</p>
<p><span class="math display">\[
f(x) = -20 + 34 x - 16 x^2 + 2 x^3
\]</span></p>
<p>More generally a polynomial is a function like</p>
<p><span class="math display">\[
f(x) = c_0 + c_1 \cdot x + c_2 \cdot x^2 + \dots + c_d \cdot x^d
\]</span></p>
<p>where the <span class="math inline">\(d+1\)</span> coefficients <span class="math inline">\(c_0, c_1, \dots, c_d\)</span> are constants The number <span class="math inline">\(d\)</span> is called the <em>degree</em> of the polynomial â€“ this is the largest exponent that appears.</p>
<p>Polynomials are flexible functions that can be quite useful for modeling. We can fit a polynomial model by adding new transformed variables to the data frame then fitting a linear model with these new transformed variables. This is just like how we fit a logarithmic function before by adding a new log transformed variable to the data frame then fit a linear model.</p>
<!---

::: {.cell}

```{.r .cell-code  code-fold="false"}
df
```

::: {.cell-output .cell-output-stdout}

```
# A tibble: 100 Ã— 2
       x      y
   <dbl>  <dbl>
 1  1.02 -2.61 
 2  3.33 -7.59 
 3  5.24  5.20 
 4  2.82 -8.64 
 5  5.40 11.9  
 6  2.57 -3.53 
 7  5.10  1.24 
 8  2.07 -0.920
 9  2.41 -1.36 
10  1.79  0.853
# â„¹ 90 more rows
```


:::
:::

::: {.cell}

```{.r .cell-code  code-fold="false"}
df_with_poly <- df %>% 
    mutate(x_sq = x^2,
           x_cube = x^3)

lm_poly <- lm(y ~ x + x_sq + x_cube, data = df_with_poly)
lm_poly
```

::: {.cell-output .cell-output-stdout}

```

Call:
lm(formula = y ~ x + x_sq + x_cube, data = df_with_poly)

Coefficients:
(Intercept)            x         x_sq       x_cube  
    -20.086       34.669      -16.352        2.042  
```


:::
:::


Now we can plot the predictions as a function of the original x variable.


::: {.cell layout-align="center"}

```{.r .cell-code}
df_with_poly %>% 
    mutate(y_pred = predict(lm_poly, data=df_with_poly)) %>% 
    ggplot(aes(x=x, y=y)) +
    geom_point() + 
    geom_line(aes(x=x, y=y_pred), color='red') +
    theme_bw()
```

::: {.cell-output-display}
![](notes_files/figure-html/unnamed-chunk-15-1.png){fig-align='center' width=672}
:::
:::



#### Shortcut to fitting polynomials
-->
<p>The prediction function here is a polynomial given by</p>
<p><span class="math display">\[
\widehat{y} = -20.086 + 34.669 \cdot x -16.352 \cdot x^2 + 2.042 \cdot x^3
\]</span></p>
<!-- RAAWRRRR I cannot get interpolation to work  -->
<!-- Ok now what does a 50 degree polynomial fit look like? -->
<!-- ```{r} -->
<!-- lm_poly_big <-  lm(y~ poly(x, 101, raw=T), data=df) -->
<!-- df %>% -->
<!--      mutate(y_pred = predict(lm_poly_big, data=df)) %>% -->
<!--      ggplot(aes(x=x, y=y)) + -->
<!--      geom_point() + -->
<!--      geom_line(aes(x=x, y=y_pred), color='red') -->
<!-- ``` -->
</section></section><section id="the-ideas-in-code" class="level2"><h2 class="anchored" data-anchor-id="the-ideas-in-code">The Ideas in Code</h2>
<section id="inspect-model-output-with-the-broom-library" class="level3"><h3 class="anchored" data-anchor-id="inspect-model-output-with-the-broom-library">Inspect model output with the <code>broom</code> library</h3>
<p>Consider the code we ran earlier to fit a linear model which can predict graduation rate using the poverty rate.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Graduates</span> <span class="op">~</span> <span class="va">Poverty</span>, data <span class="op">=</span> <span class="va">poverty</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When you run this code, youâ€™ll see a new object appear in your environment: <code>m1</code>. This new object, though, is not a vector or a data frame. Itâ€™s a much richer object called a <em>list</em> that stores all sorts of information about your linear model. You can click through the different part of <code>m1</code> in your environment pane, or your can use functions from the <code>broom</code> package to extract the important components using code.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/glance.html">glance</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 Ã— 12
  r.squared adj.r.squared sigma statistic  p.value    df logLik   AIC   BIC
      &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     0.558         0.549  2.50      61.8 3.11e-10     1  -118.  242.  248.
# â„¹ 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;</code></pre>
</div>
</div>
<p>The <code><a href="https://generics.r-lib.org/reference/glance.html">glance()</a></code> function returns a series of different metrics used to evaluate the quality of your model. First among those is r-squared. Because the output of <code><a href="https://generics.r-lib.org/reference/glance.html">glance()</a></code> is just another data frame, we can extract just the r-squared column using <code>select()</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/glance.html">glance</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="va">r.squared</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 Ã— 1
  r.squared
      &lt;dbl&gt;
1     0.558</code></pre>
</div>
</div>
<p>Hereâ€™s the <span class="math inline">\(R^2\)</span> we got earlier!</p>
</section><section id="fitting-polynomials-in-r-with-poly" class="level3"><h3 class="anchored" data-anchor-id="fitting-polynomials-in-r-with-poly">Fitting polynomials in R with <code>poly()</code>
</h3>
<p>In R, we can fit polynomials using the <code><a href="https://rdrr.io/r/stats/poly.html">poly()</a></code> function. Here is the code that was used to fit the polynomial earlier in the notes.</p>
<p>You do not need to worry about the meaning behind the <code>raw = TRUE</code> argument. The simulated data frame mentioned earlier is called <code>df</code>, and has two variables in it: <code>predictor</code> and <code>response</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">response</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">predictor</span>, </span>
<span>                   degree <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                   raw <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = response ~ poly(x = predictor, degree = 3, raw = TRUE), 
    data = df)

Coefficients:
                                 (Intercept)  
                                     -20.086  
poly(x = predictor, degree = 3, raw = TRUE)1  
                                      34.669  
poly(x = predictor, degree = 3, raw = TRUE)2  
                                     -16.352  
poly(x = predictor, degree = 3, raw = TRUE)3  
                                       2.042  </code></pre>
</div>
</div>
</section><section id="making-predictions-on-a-new-observation-with-predict" class="level3"><h3 class="anchored" data-anchor-id="making-predictions-on-a-new-observation-with-predict">Making predictions on a new observation with <code>predict()</code>
</h3>
<p>We have spending a lot of time talking about how to fit a model meant for predicting, but have not actually done any predicting! The <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> function can help us do this. It takes in two main arguments:</p>
<ul>
<li>
<code>object</code>: This is the linear model object which contains the coefficients <span class="math inline">\(b_0\)</span>, â€¦, <span class="math inline">\(b_p\)</span>. In the graduate and poverty example, this object was <code>m1</code>. We had <code>m1</code> through <code>m4</code> in the ZAGAT example.</li>
<li>
<code>newdata</code>: This is a <em>data frame</em> containing the new observation(s). This data frame must at least contain each of the predictor variables used in the column, with a value of these variables for each observation.</li>
</ul>
<section id="example-zagat-food-rating" class="level4"><h4 class="anchored" data-anchor-id="example-zagat-food-rating">Example: ZAGAT food rating</h4>
<p>Here, we will use <code>m2</code> from the ZAGAT example. This model used <span class="math inline">\(food\)</span> and <span class="math inline">\(geo\)</span> in an attempt to predict price at a restaurant.</p>
<p>First, letâ€™s make a new data frame with a couple of new, made-up observations.</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">restaurants</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  food <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">17</span><span class="op">)</span>,</span>
<span>  geo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"east"</span>, <span class="st">"west"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>One of these restaurants is located in east Manhattan and has a food score of 25/30, while the other one is in west Manhattan and has a food score of 17/30.</p>
<p>Now, we can use this data frame alongside our <code>m2</code> model object to make predictions for the prices.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">m2</span>, newdata <span class="op">=</span> <span class="va">restaurants</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1        2 
55.89738 31.44043 </code></pre>
</div>
</div>
<p>We are predicted to have to pay roughly <span class="math inline">\(\$56\)</span> at the first restaurant and roughly <span class="math inline">\(\$31\)</span> at the second.</p>
</section></section></section><section id="summary" class="level2"><h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>In this lecture we learned how to evaluate and improve out predictions. While there are many metrics to measure the explanatory power of a model, one of the most commonly used is <span class="math inline">\(R^2\)</span>, the proportion of the variability of the <span class="math inline">\(y\)</span> that is explained by the model.</p>
<p>To improve our predictions - and increase the <span class="math inline">\(R^2\)</span> - we saw three different strategies. If you have additional predictors in your data frame, its easy as pie to add them to your regression model and you are guaranteed to increase your <span class="math inline">\(R^2\)</span>.</p>
<p>A second strategy is capture non-linear structure by creating new variables that are simple transformations of the existing variable. The third approach, also targeting non-linear structure, is to replace a single predictor with a polynomial.</p>


</section><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>
<ol>
<li id="fn1"><p>We call this concave or sometimes <em>diminishing marginal returns</em>.<a href="#fnref1" class="footnote-back" role="doc-backlink">â†©ï¸Ž</a></p></li>
</ol></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../../6-prediction/01-method-of-least-squares/notes.html" class="pagination-link  aria-label=" the="" method="" of="" least="" squares="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">The Method of Least Squares</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../6-prediction/03-overfitting/notes.html" class="pagination-link" aria-label="Overfitting">
        <span class="nav-page-text">Overfitting</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
<li class="nav-item">
    <a class="nav-link" href="https://www.netlify.com/">
<p>This site is hosted by Netlify.</p>
</a>
  </li>  
</ul>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item">
    <a class="nav-link" href="../../license.html">
<p>License</p>
</a>
  </li>  
</ul>
</div>
  </div>
</footer>


</body></html>