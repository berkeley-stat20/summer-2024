<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Stat 20 - Lab: Arbuthnot</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>

<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-WP7F4QKDC8"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-WP7F4QKDC8', { 'anonymize_ip': true});
</script><link href="../../../site_libs/countdown-0.4.0/countdown.css" rel="stylesheet">
<script src="../../../site_libs/countdown-0.4.0/countdown.js"></script>
<meta property="og:title" content="Stat 20 - Lab: Arbuthnot">
<meta property="og:image" content="https://stat20.berkeley.edu/summer-2024/2-summarizing-data/labs/01-arbuthnot/assets/stat20-hex.png">
<meta property="og:site_name" content="Stat 20">
<meta name="twitter:title" content="Stat 20 - Lab: Arbuthnot">
<meta name="twitter:image" content="https://stat20.berkeley.edu/summer-2024/2-summarizing-data/labs/01-arbuthnot/assets/stat20-hex.png">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-sm " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/stat20-hex-small.png" alt="Stat 20 logo" class="navbar-logo"></a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../../syllabus.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../office-hours.html"> 
<span class="menu-text">Office Hours</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../notes.html"> 
<span class="menu-text">Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../assignments.html"> 
<span class="menu-text">Assignments</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools tools-wide">
    <a href="https://edstem.org/us/courses/51198" title="" class="quarto-navigation-tool px-1" aria-label="Ed Discussion Forum"><i class="bi bi-chat-fill"></i></a>
    <a href="https://www.gradescope.com/courses/693050" title="" class="quarto-navigation-tool px-1" aria-label="Gradescope"><i class="bi bi-bar-chart-fill"></i></a>
    <a href="https://stat20.datahub.berkeley.edu/" title="" class="quarto-navigation-tool px-1" aria-label="RStudio"><i class="bi bi-r-circle-fill"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#the-goal-of-labs" id="toc-the-goal-of-labs" class="nav-link active" data-scroll-target="#the-goal-of-labs">The Goal of Labs</a></li>
  <li>
<a href="#lab-arbuthnot" id="toc-lab-arbuthnot" class="nav-link" data-scroll-target="#lab-arbuthnot">Lab: Arbuthnot</a>
  <ul class="collapse">
<li>
<a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a>
  <ul class="collapse">
<li><a href="#what-evidence-do-we-ultimately-rely-upon" id="toc-what-evidence-do-we-ultimately-rely-upon" class="nav-link" data-scroll-target="#what-evidence-do-we-ultimately-rely-upon">What evidence do we ultimately rely upon?</a></li>
  </ul>
</li>
  <li><a href="#dr.-john-arbuthnot" id="toc-dr.-john-arbuthnot" class="nav-link" data-scroll-target="#dr.-john-arbuthnot">Dr.&nbsp;John Arbuthnot</a></li>
  <li><a href="#arbuthnots-london" id="toc-arbuthnots-london" class="nav-link" data-scroll-target="#arbuthnots-london">Arbuthnot’s London</a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1"></a></li>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2"></a></li>
  <li><a href="#section-3" id="toc-section-3" class="nav-link" data-scroll-target="#section-3"></a></li>
  <li><a href="#what-is-a-christening-record" id="toc-what-is-a-christening-record" class="nav-link" data-scroll-target="#what-is-a-christening-record">What is a christening record?</a></li>
  <li><a href="#your-lab-assignment" id="toc-your-lab-assignment" class="nav-link" data-scroll-target="#your-lab-assignment">Your Lab Assignment</a></li>
  </ul>
</li>
  <li><a href="#lab-1.1-understanding-the-context-of-the-data-1" id="toc-lab-1.1-understanding-the-context-of-the-data-1" class="nav-link" data-scroll-target="#lab-1.1-understanding-the-context-of-the-data-1">Lab 1.1: Understanding the Context of the Data</a></li>
  </ul><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="slides.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">Lab: Arbuthnot</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="the-goal-of-labs" class="level2"><h2 class="anchored" data-anchor-id="the-goal-of-labs">The Goal of Labs</h2>
<div class="incremental">
<ul class="incremental">
<li><p>Put concepts into practice with real data</p></li>
<li><p>Follow best practices in reproducible analyses (.qmd)</p></li>
<li><p>In class we’ll work on the most challenging problems</p></li>
<li><p>You likely will need to work outside of class to finish the assignment</p></li>
<li><p>Visit office hours for extra help or ask on named thread on Ed</p></li>
</ul>
</div>
</section><section id="lab-arbuthnot" class="level1"><h1>Lab: Arbuthnot</h1>
<section id="section" class="level2"><h2 class="anchored" data-anchor-id="section"></h2>
<div class="bigadage" style="text-align: center">
<p>What is the chance that a child born tomorrow is a girl?</p>
</div>
<div class="notes">
<p>Most students will volunteer 50%. Follow up with:</p>
<blockquote class="blockquote">
<p>Why do you think it’s 50%? How did you come to that number? - Did you read it somewhere? - Did you hear it from someone?</p>
</blockquote>
<blockquote class="blockquote">
<p>If you wanted to confirm it was 50% what would you do? - [likely answer: google it]</p>
</blockquote>
<blockquote class="blockquote">
<p>What source for that number would you likely come across if you kept digging? - ultimately, maybe some scientific article.</p>
</blockquote>
<blockquote class="blockquote">
<p>What would their evidence for that claim of 50%? - likely vast amounts of demographic / census data</p>
</blockquote>
</div>
<p>. . .</p>
<blockquote class="blockquote">
<p>50%?</p>
</blockquote>
<p>. . .</p>
<section id="what-evidence-do-we-ultimately-rely-upon" class="level3"><h3 class="anchored" data-anchor-id="what-evidence-do-we-ultimately-rely-upon">What evidence do we ultimately rely upon?</h3>
<p>. . .</p>
<blockquote class="blockquote">
<p>Vast amounts of data</p>
</blockquote>
<div class="notes">
<p>Now consider the case of a scientist who tackled this question long before google was around.</p>
</div>
</section></section><section id="dr.-john-arbuthnot" class="level2"><h2 class="anchored" data-anchor-id="dr.-john-arbuthnot">Dr.&nbsp;John Arbuthnot</h2>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li>1667 - 1735</li>
<li>Scottish physician, mathematician, satirist</li>
<li>Interested in the question of what the proportion of girls to boys was at birth</li>
</ul>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/arbuthnot-portrait.png" class="img-fluid figure-img"></p>
<figcaption>A painted portrait of John Arbuthnot</figcaption></figure>
</div>
</div>
</div>
<!-- Credit: Godfrey Kneller, Public domain, via Wikimedia Commons -->
<div class="notes">
<p>Read a bit about Arbuthnot on wikipedia to learn some of his backstory.</p>
</div>
</section><section id="arbuthnots-london" class="level2"><h2 class="anchored" data-anchor-id="arbuthnots-london">Arbuthnot’s London</h2>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li>1710, St.&nbsp;Paul’s Cathedral completed</li>
<li>Very few paved streets</li>
<li>Definitely no google</li>
</ul>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/thames.png" class="img-fluid figure-img"></p>
<figcaption>A painting of London in 1710.</figcaption></figure>
</div>
</div>
</div>
<!-- credit: Giovanni Antonio Canal, il Canaletto - The River Thames with St. Paul's Cathedral on Lord Mayor's Day, detail, 1746-47 -->
<div class="notes">
<p>Arbuthnot was living in London while thinking about this problem. It was a period of rapid growth and modernization for the city but it still had no google.</p>
<p>Main point to get across here: what we take for granted in terms of how we reason from data was nearly absent from life in 18th century UK. Most people would reason from direct experience, anecdote, appeals to tradition or religion, etc.</p>
<p>If you were Dr.&nbsp;Arbuthnot and you tell the person on the street: “My wife will soon be giving birth. What are the chances it’s a girl?”, what sort of answer do you think he might get? What type of information might that person be relying upon? - their own experience (the ratio of girls born in their family) - anecdotes that they’ve heard from others</p>
<p>You may want to note that even our notion of “chance” and probability was not wide spread at the time.</p>
<p>Arbuthnot’s work is notable because he takes the big step of realizing that an individual can learn a lot by pooling the experiences / anecdotes of others in a systematic way.</p>
</div>
</section><section id="section-1" class="level2"><h2 class="anchored" data-anchor-id="section-1"></h2>
<div class="bigadage" style="text-align: center">
<p>Where could Arbuthnot find vast amounts on systematically collected data regarding births?</p>
</div>
<p>. . .</p>
<blockquote class="blockquote">
<p>The church.</p>
</blockquote>
</section><section id="section-2" class="level2"><h2 class="anchored" data-anchor-id="section-2"></h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/christenings.png" class="img-fluid figure-img"></p>
<figcaption>A photograph of a page of a book of handwritten christening records taken a church in England in the 18th century</figcaption></figure>
</div>
<div class="notes">
<p>The church is the only organization that is collecting systematic demographic data in this era.</p>
</div>
</section><section id="section-3" class="level2"><h2 class="anchored" data-anchor-id="section-3"></h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/christenings-zoom.png" class="img-fluid figure-img"></p>
<figcaption>A zoomed in version of the christening records, where you can identify that each record was a single christening.</figcaption></figure>
</div>
<div class="notes">
<p>Most children, shortly after they’re born, are taken to the nearby parish church and “christened” - given a name in the church. The parish churches record the name and date of each of these christenings.</p>
<p>Arbuthnot went from parish church to parish church in London, pored over these records and tallied the number of boys and girls. He then combined these counts across all of the parishes and created a data set that we can read into R today.</p>
</div>
</section><section id="what-is-a-christening-record" class="level2"><h2 class="anchored" data-anchor-id="what-is-a-christening-record">What is a christening record?</h2>
<p>. . .</p>
<p>A Christening is a ceremony/rite in the Church of England where:</p>
<ol type="1">
<li><p>The parents bring their new born child to a priest at the church.</p></li>
<li><p>As part of the ceremony, the parents give a first name to the child before the child is baptized (inducted into the church).</p></li>
<li><p>The name of the child and their parents are recorded in a ledger.</p></li>
</ol>
<p>. . .</p>
<p>John Arbuthnot tabulated the total count of names in each year that were traditionally female and male names.</p>
</section><section id="your-lab-assignment" class="level2"><h2 class="anchored" data-anchor-id="your-lab-assignment">Your Lab Assignment</h2>
<div class="columns">
<div class="column" style="width:50%;">
<section id="lab-1.1-understanding-the-context-of-the-data" class="level4"><h4 class="anchored" data-anchor-id="lab-1.1-understanding-the-context-of-the-data">Lab 1.1: Understanding the Context of the Data</h4>
<ul>
<li>Learn context</li>
<li>Formulate questions</li>
<li>Set expectations</li>
<li>Submitted as pdf of worksheet</li>
</ul></section>
</div>
<div class="column fragment" style="width:50%;">
<section id="lab-1.2-computing-with-the-data" class="level4"><h4 class="anchored" data-anchor-id="lab-1.2-computing-with-the-data">Lab 1.2: Computing with the Data</h4>
<ul>
<li>Dive into the data</li>
<li>Submitted as a pdf from a qmd.</li>
</ul></section>
</div>
</div>
</section></section><section id="lab-1.1-understanding-the-context-of-the-data-1" class="level1"><h1>Lab 1.1: Understanding the Context of the Data</h1>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="timer_15e8ccbf" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls">
<button class="countdown-bump-down">−</button><button class="countdown-bump-up">&amp;plus;</button>
</div>
<code class="countdown-time"><span class="countdown-digits minutes">25</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item">
    <a class="nav-link" href="../../../license.html">
<p>License</p>
</a>
  </li>  
</ul>
</div>
  </div>
</footer>


</body></html>